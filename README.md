

# How does it work?
  使用8266模块采集SHT10温湿度数据并通过UART将太阳能逆变器内部数据取出并上传lewei50.com

# License
Copyright (c) 2016 [Bill Deng]
Licensed under the [The MIT License (MIT)](http://opensource.org/licenses/MIT).

# UPS通信协议
逆变系统与上位机通信协议（暂行）

本通信协议规定了上位机对逆变系统相关状态、参数及控制的操作说明。通信速率2400bps； 8，n，1；采用标准CRC16校验（CRC校验低字节在前）；接收数据校验错误不返回数据；不能解析的命令固定返回（地址+0XFF+ CRC_L+CRC_H）。
上位机发送数据格式：地址（下位机）+命令+CRC16；
下位机返回数据格式：地址+命令+数据(不同的命令数据长度不同)+CRC16
一、查询命令
1、工作状态及电压数据
上位机命令格式（共4字节）：地址+0X10+ CRC_L+CRC_H
下位机返回数据（共14字节）：地址+0X10+状态+输入电压高字节+输入电压低字节+输出电压高字节+输出电压低字节+电池电压高字节+电池电压低字节+频率+ 电池容量百分比+负载百分比+CRC_L+CRC_H

		状态：b7--逆变模式  b6--电池电压低  b5--蜂鸣器禁鸣  b4--短路故障 
	b3--自检   b2--温度高  	b1--关机	   b0--过载
二、控制命令
1、开机（有用）
	上位机命令格式（共4字节）：地址+0X80+ CRC_L+CRC_H
         下位机返回数据：执行命令后原样返回
2、关机（无用）
	上位机命令格式（共4字节）：地址+0X81+ CRC_L+CRC_H
         下位机返回数据：执行命令后原样返回
3、市电到逆变
   上位机命令格式（共4字节）：地址+0X82+ CRC_L+CRC_H
下位机返回数据：执行命令后原样返回
4、逆变到市电
   上位机命令格式（共4字节）：地址+0X83+ CRC_L+CRC_H
下位机返回数据：执行命令后原样返回



CRC 生成流程：
1 预置一个16 位寄存器为0xFFFFH（全1），称之为CRC 寄存器。
2 把数据帧中的第一个字节的8 位与CRC 寄存器中的低字节进行异或运算，结果存回CRC 寄存器。
3 将CRC 寄存器向右移一位，最高位填0，最低位移出并检测。
4 如果最低位移出为0：重复第3 步（下一次移位）；如果最低位移出为1：将CRC
寄存器与一个预设固定值（0xA001H）进行异或运算。
5 重复第3 步和第4 步直到8 次移位。这样就处理完了一个完整的8 位。
6 重复第2 步到第5 步来处理下一个8 位，直到所有的字节处理结束。
7 最终CRC 寄存器的值就是CRC 的值

查表计算CRC 的方法请查阅相关资料。


2：
内部调试命令：0x59 0x0D
返回：
状态+输入电压+输出电压+电池容量百分比+负载百分比+电池电压+频率+0x0d
各值需要乘相应的系数，每台机器不同。
样本：A0 0E 8E 64 00 38 32 0D（逆变、0v、222.6、100、0、53.1、50、）

数据采样：
01 10 02 00 00 00 00 02 3F 00 64 7C 32 3E （待机，输出0，电池57.5，电池容量100，负载0）
01 10 A0 00 00 08 C1 02 20 17 5C F4 A8 11（开机，输出224.1，电池54.4，电池容量92，负载1.3kw）
